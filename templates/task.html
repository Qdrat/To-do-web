 {% extends "base.html" %}

{% block content %}
    <h1>üìù –ú–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–¥–∞—á</h1>

    <!-- –§–æ—Ä–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ -->
    <form class="filter-form" method="get">
        <div class="form-group">
            <input type="text" name="search" placeholder="–ü–æ–∏—Å–∫ –∑–∞–¥–∞—á..." value="{{ request.args.get('search', '') }}">
            <select name="category">
                <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                {% for cat in categories %}
                    <option value="{{ cat.id }}" {% if request.args.get('category', type=int) == cat.id %}selected{% endif %}>
                        {{ cat.name }}
                    </option>
                {% endfor %}
            </select>
            <select name="priority">
                <option value="">–í—Å–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã</option>
                {% for p in ['High','Medium','Low'] %}
                    <option value="{{ p }}" {% if request.args.get('priority') == p %}selected{% endif %}>
                        {{ p }}
                    </option>
                {% endfor %}
            </select>
            <select name="show_completed">
                <option value="all" {% if request.args.get('show_completed','all')=='all' %}selected{% endif %}>–í—Å–µ –∑–∞–¥–∞—á–∏</option>
                <option value="active" {% if request.args.get('show_completed')=='active' %}selected{% endif %}>–¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ</option>
                <option value="completed" {% if request.args.get('show_completed')=='completed' %}selected{% endif %}>–¢–æ–ª—å–∫–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ</option>
            </select>
        </div>
        <button type="submit">üîç –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
        <a href="{{ url_for('index') }}" style="margin-left: 10px;">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</a>
    </form>

    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏ -->
    <form class="add-form" method="post">
        <input type="hidden" name="add_task" value="1">
        <div class="form-group">
            <input type="text" name="title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏" required>
            <select name="priority">
                {% for p in ['High','Medium','Low'] %}
                    <option value="{{ p }}">{{ p }}</option>
                {% endfor %}
            </select>
            <select name="category_id">
                <option value="None">–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                {% for cat in categories %}
                    <option value="{{ cat.id }}">{{ cat.name }}</option>
                {% endfor %}
            </select>
            <input type="text" name="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏">
        </div>
        <button type="submit">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</button>
    </form>

    <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ -->
    <a href="{{ url_for('categories') }}">üìÇ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏</a>

    <hr>

    <!-- –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á -->
    {% for task in tasks %}
        <div class="task {% if task.completed %}completed{% endif %}">
            <span class="priority-{{ task.priority }}">[{{ task.priority }}]</span>
            <strong>{{ task.title }}</strong>
            {% if task.category %}
                <span class="category">({{ task.category.name }})</span>
            {% endif %}
            {% if task.description %}
                <div>{{ task.description }}</div>
            {% endif %}
            <div class="actions">
                <a href="{{ url_for('edit_task', task_id=task.id) }}">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                <form action="{{ url_for('delete_task', task_id=task.id) }}" method="post" style="display:inline;">
                    <button type="submit" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–¥–∞—á—É?')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                </form>
                <form action="{{ url_for('toggle_complete', task_id=task.id) }}" method="post" style="display:inline;">
                    <button type="submit">
                        {% if task.completed %}‚úÖ –í–µ—Ä–Ω—É—Ç—å –≤ —Ä–∞–±–æ—Ç—É{% else %}‚òëÔ∏è –í—ã–ø–æ–ª–Ω–∏—Ç—å{% endif %}
                    </button>
                </form>
            </div>
        </div>
    {% else %}
        <p>üì≠ –ó–∞–¥–∞—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>
    {% endfor %}
{% endblock %}